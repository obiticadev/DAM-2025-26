Esta es la **Cheatsheet Profesional de SQL (Consultas Avanzadas)**, organizada l칩gica y jer치rquicamente siguiendo la filosof칤a de estructuraci칩n que me has facilitado. Est치 dise침ada para llevar al estudiante desde el concepto m치s b치sico de uni칩n de tablas hasta la l칩gica compleja de las subconsultas.

---

# 游닂 SQL Cheatsheet: Consultas Multitabla y Subconsultas

## 1. Fundamentos de la Combinaci칩n de Tablas
En el modelo relacional, la informaci칩n se distribuye en varias tablas para evitar la duplicidad. Para obtener datos combinados, necesitamos realizar una **Composici칩n** o **JOIN**.

*   **Concepto clave:** La uni칩n se basa en campos comunes (generalmente Clave Primaria en una tabla y Clave Ajena en otra).
*   **Producto Cartesiano:** Si unimos dos tablas sin condiciones, el resultado es la combinaci칩n de todas las filas de la primera con todas las de la segunda ($N \times M$ filas). Es una operaci칩n costosa y poco habitual.

---

## 2. Composiciones Internas (Inner Joins)
Devuelven solo las filas que tienen una coincidencia exacta en ambas tablas.

### A. Sintaxis Tradicional (Cl치usula `WHERE`)
Se listan las tablas en el `FROM` y se establece la condici칩n de igualdad en el `WHERE`.
```sql
SELECT empleados.nombre, departamentos.nombre_dpto
FROM EMPLEADOS, DEPARTAMENTOS
WHERE EMPLEADOS.dpto_cod = DEPARTAMENTOS.dpto_cod;
```

### B. Reglas de Oro
*   **Ambig칲edad:** Si una columna se llama igual en ambas tablas, se debe usar el prefijo `tabla.columna`.
*   **Alias de Tabla:** Se usan para acortar el c칩digo (ej. `FROM EMPLEADOS E`).
*   **Columnas de Emparejamiento:** No es obligatorio que aparezcan en el `SELECT`, pero s칤 en la condici칩n.

---

## 3. Composiciones Externas (Outer Joins)
Se usan cuando queremos mostrar filas que **no tienen correspondencia** en la otra tabla (por ejemplo, un departamento que a칰n no tiene empleados).

### A. Sintaxis Tradicional (Oracle `(+)`)
El signo `(+)` se coloca en el lado de la tabla que "faltan" datos (la que aceptar치 los nulos).
```sql
-- Muestra todos los departamentos, aunque no tengan jefe (empleado)
SELECT D.nombre_dpto, E.nombre
FROM DEPARTAMENTOS D, EMPLEADOS E
WHERE D.jefe = E.dni (+);
```

---

## 4. Est치ndar SQL99 (Sintaxis Moderna)
Es la forma recomendada actualmente para separar la l칩gica de uni칩n de la l칩gica de filtrado de registros.

| Tipo de Join | Descripci칩n |
| :--- | :--- |
| **CROSS JOIN** | Genera un producto cartesiano expl칤cito. |
| **NATURAL JOIN** | Une autom치ticamente por columnas con el mismo nombre. |
| **JOIN USING (col)** | Une por una columna espec칤fica que se llama igual en ambas. |
| **JOIN ON (cond)** | Permite unir por columnas con nombres distintos o condiciones complejas. |
| **LEFT OUTER JOIN** | Muestra todo de la tabla de la IZQUIERDA + coincidencias. |
| **RIGHT OUTER JOIN** | Muestra todo de la tabla de la DERECHA + coincidencias. |
| **FULL OUTER JOIN** | Muestra todas las filas de ambas tablas, haya coincidencia o no. |

**Ejemplo SQL99:**
```sql
SELECT E.nombre, H.fecha_inicio
FROM EMPLEADOS E 
JOIN HISTORIAL_LABORAL H ON (E.dni = H.empleado_dni);
```

---

## 5. Operaciones de Conjuntos
Permiten combinar el resultado de dos o m치s sentencias `SELECT` completas.

**Requisitos obligatorios:**
1.  Mismo n칰mero de columnas en ambos `SELECT`.
2.  Mismo tipo de datos en el mismo orden.

### Tipos de Operaciones

| Operador | Acci칩n | Resultado |
| :--- | :--- | :--- |
| **UNION** | Suma los resultados de ambos SELECT. | Elimina duplicados. |
| **INTERSECT** | Devuelve solo las filas que est치n en AMBOS resultados. | Solo coincidencias comunes. |
| **MINUS** | Resta al primer resultado lo que aparezca en el segundo. | Filas exclusivas del primer SELECT. |

---

## 6. Subconsultas
Una subconsulta es una sentencia `SELECT` anidada dentro de otra (consulta principal).

### A. Caracter칤sticas
*   Se escriben entre **par칠ntesis**.
*   Se colocan a la **derecha** del operador de comparaci칩n.
*   Pueden usarse en las cl치usulas `WHERE`, `HAVING` y `FROM`.

### B. Subconsultas de Fila 칔nica
Usan operadores est치ndar: `=`, `>`, `<`, `>=`, `<=`, `<>`.
```sql
-- Empleados que ganan menos que Ana
SELECT nombre, sueldo 
FROM EMPLEADOS 
WHERE sueldo < (SELECT sueldo FROM EMPLEADOS WHERE nombre = 'Ana');
```

### C. Subconsultas de Varias Filas
Si la subconsulta devuelve m치s de un valor, se deben usar operadores especiales:

*   **IN:** El valor debe estar contenido en la lista de resultados.
*   **NOT IN:** El valor no debe estar en la lista.
*   **ANY:** Compara con "cualquiera" de los valores (al menos uno).
*   **ALL:** Debe cumplir la condici칩n con "todos" los valores de la lista.

**Ejemplo `ALL`:**
```sql
-- Empleado que menos cobra (su sueldo es menor o igual a TODOS los sueldos)
SELECT nombre, sueldo 
FROM EMPLEADOS 
WHERE sueldo <= ALL (SELECT sueldo FROM EMPLEADOS);
```

---

## 游눠 Resumen de Aprendizaje L칩gico
1.  **쯅ecesitas datos de otra tabla?** Usa `JOIN`.
2.  **쯈uieres solo los que coinciden?** `INNER JOIN`.
3.  **쯈uieres conservar los que no tienen pareja?** `OUTER JOIN`.
4.  **쯈uieres unir dos resultados distintos?** `UNION / INTERSECT / MINUS`.
5.  **쮼l filtro depende de un dato que no conoces y debes calcular?** `SUBCONSULTA`.