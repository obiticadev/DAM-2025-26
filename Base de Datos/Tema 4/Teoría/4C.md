# Leyenda de Colores

- <mark style="background-color: #ffff00;">Amarillo</mark>: Para conceptos fundamentales, definiciones y puntos clave.
- <mark style="background-color: #90ee90;">Verde</mark>: Para ventajas, objetivos, propósitos y características positivas.
- <mark style="background-color: #add8e6;">Azul</mark>: Para tipos, clasificaciones, componentes, estructuras y ejemplos.
- <mark style="background-color: #ffa07a;">Rojo/Salmón</mark>: Para problemas, inconvenientes, limitaciones o advertencias.
- <mark style="background-color: #d3d3d3;">Gris</mark>: Para tecnologías específicas, nombres propios, estándares o secciones explícitamente marcadas como "Contenido Prioritario".

---

# Guía Técnica Avanzada: Consultas Multitabla y Subconsultas en Entornos Relacionales

## 1. Fundamentos de la Relacionalidad y la Necesidad de Composición

En el diseño de arquitecturas de datos modernas, la <mark style="background-color: #ffff00;">normalización</mark> no es un objetivo opcional, sino una exigencia técnica para <mark style="background-color: #90ee90;">garantizar la integridad y eliminar la redundancia</mark>. Esta práctica distribuye la información en múltiples entidades especializadas vinculadas mediante <mark style="background-color: #add8e6;">campos comunes</mark>. No obstante, la segmentación lógica impone el reto de la <mark style="background-color: #ffff00;">recomposición</mark>: para recuperar una visión coherente del negocio, el ingeniero de datos debe orquestar <mark style="background-color: #add8e6;">consultas multitabla</mark> que reconstruyan las relaciones originales sin comprometer el rendimiento.

### Distribución de la Información

La clave reside en el uso de <mark style="background-color: #ffff00;">campos comunes</mark>. Consideremos el <mark style="background-color: #add8e6;">ejemplo de las tablas USUARIOS (con clave principal Login) y PARTIDAS (vinculadas por el campo Cod_Creación)</mark>. Si el sistema requiere un informe que asocie el nombre del jugador con las horas acumuladas en sus sesiones, es imperativo extraer registros de ambas tablas, ya que la identidad reside en la primera y la métrica temporal en la segunda.

### El Riesgo del Producto Cartesiano

Desde una perspectiva de sistemas, combinar tablas sin restricciones de unión genera un <mark style="background-color: #ffa07a;">Producto Cartesiano</mark>. Esta operación produce <mark style="background-color: #ffa07a;">todas las combinaciones posibles entre las filas</mark> de las tablas involucradas.

*   <mark style="background-color: #ffff00;">Impacto Técnico</mark>: Si asociamos <mark style="background-color: #add8e6;">dos tablas de 10 registros cada una</mark>, el resultado será de <mark style="background-color: #ffa07a;">10 x 10 = 100 filas</mark>.
*   <mark style="background-color: #ffff00;">Evaluación de Eficiencia</mark>: En entornos de producción, el <mark style="background-color: #ffa07a;">crecimiento exponencial de las filas</mark> puede provocar el <mark style="background-color: #ffa07a;">agotamiento de la memoria volátil y una saturación de las operaciones de entrada/salida (I/O)</mark>. Esta ineficiencia convierte al producto cartesiano en una <mark style="background-color: #ffa07a;">operación prohibida</mark> para cualquier arquitecto de sistemas, salvo en casos de diseño de pruebas específicos.

Para mitigar este riesgo, es imperativo aplicar mecanismos de discriminación de registros mediante las <mark style="background-color: #ffff00;">composiciones internas</mark>.

---

## 2. Composiciones Internas (Inner Joins) y Reglas de Asociación

La <mark style="background-color: #ffff00;">composición interna</mark> es el método estándar para <mark style="background-color: #90ee90;">emparejar registros que poseen valores idénticos</mark> en sus columnas de unión. Este proceso asegura que el conjunto de resultados mantenga una <mark style="background-color: #90ee90;">integridad referencial estricta</mark>, excluyendo cualquier dato que carezca de correspondencia.

### Reglas Críticas para Composiciones Profesionales

Un especialista senior debe observar siempre las siguientes directrices:

1.  <mark style="background-color: #add8e6;">Combinación Múltiple</mark>: El motor relacional permite unir tantas tablas como el modelo de datos exija.
2.  <mark style="background-color: #add8e6;">Criterios de Columnas</mark>: La asociación puede fundamentarse en una o varias parejas de campos.
3.  <mark style="background-color: #90ee90;">Flexibilidad del SELECT</mark>: Es posible proyectar columnas de cualquier tabla implicada, formen o no parte de la condición de unión.
4.  <mark style="background-color: #ffa07a;">Resolución de Ambigüedad</mark>: Ante columnas con nombres idénticos, es obligatorio el <mark style="background-color: #ffff00;">uso de alias</mark> para garantizar la claridad sintáctica.

### El Rol de la Entidad Asociativa (Bridge)

En esquemas normalizados, a menudo necesitamos una <mark style="background-color: #add8e6;">tabla intermedia</mark> para conectar entidades que no tienen una relación directa. En nuestro modelo, la tabla <mark style="background-color: #d3d3d3;">HISTORIAL_LABORAL</mark> actúa como el <mark style="background-color: #ffff00;">puente (bridge)</mark> indispensable: vincula un <mark style="background-color: #add8e6;">DNI de la tabla EMPLEADOS</mark> con un <mark style="background-color: #add8e6;">DPTO_COD de la tabla DEPARTAMENTOS</mark>. Sin esta pieza, la relación entre el nombre de un empleado y su departamento es inexistente.

### Ejemplo de implementación (Sintaxis Clásica):

```sql
-- Unión de 3 tablas mediante la tabla puente HISTORIAL_LABORAL
SELECT D.NOMBRE_DPTO, E.NOMBRE, E.APELLIDO1, E.APELLIDO2
FROM DEPARTAMENTOS D, EMPLEADOS E, HISTORIAL_LABORAL H
WHERE E.DNI = H.EMPLEADO_DNI
  AND H.DPTO_COD = D.DPTO_COD;
```

---

## 3. Composiciones Externas: El Operador de Oracle (+)

Para obtener <mark style="background-color: #90ee90;">informes de gestión exhaustivos</mark>, es vital <mark style="background-color: #90ee90;">capturar registros "huérfanos"</mark>. Un departamento de nueva creación sin personal asignado es un dato valioso que una consulta interna omitiría, <mark style="background-color: #ffa07a;">sesgando la realidad operativa</mark>.

### Sintaxis y Posicionamiento del Operador (+)

En la <mark style="background-color: #d3d3d3;">sintaxis tradicional de Oracle</mark>, el <mark style="background-color: #ffff00;">operador (+)</mark> debe colocarse en la cláusula <mark style="background-color: #add8e6;">WHERE</mark>, específicamente detrás del campo de la tabla que <mark style="background-color: #90ee90;">aceptará valores nulos</mark> (aquella que "carece" de la información en el emparejamiento).

### Caso Práctico: El Departamento "DATAMINING"

Consideremos el departamento <mark style="background-color: #add8e6;">DATAMINING</mark> (creado mediante INSERT con jefe NULL).

1.  <mark style="background-color: #ffa07a;">Fallo de la Consulta Interna</mark>: `WHERE D.JEFE = E.DNI` <mark style="background-color: #ffa07a;">ignorará a DATAMINING</mark> por no haber correspondencia en EMPLEADOS.
2.  <mark style="background-color: #90ee90;">Éxito de la Consulta Externa</mark>: Al utilizar `D.JEFE = E.DNI(+)`, forzamos al sistema a <mark style="background-color: #90ee90;">incluir todos los departamentos</mark>, aunque el jefe no exista.

```sql
-- El operador (+) se coloca en E.DNI para preservar el registro de DEPARTAMENTOS
SELECT D.NOMBRE_DPTO, D.JEFE, E.NOMBRE, E.APELLIDO1
FROM DEPARTAMENTOS D, EMPLEADOS E
WHERE D.JEFE = E.DNI(+);
```

---

## 4. Modernización de Consultas: El Estándar SQL99

El <mark style="background-color: #d3d3d3;">estándar SQL99</mark> representa un hito en la ingeniería de consultas al <mark style="background-color: #90ee90;">separar las condiciones de asociación (lógica de unión) de las de selección (lógica de filtrado)</mark>, mejorando drásticamente la mantenibilidad del código.

### Comparativa de Funciones SQL99

| Cláusula | Función Técnica y Estratégica |
| :--- | :--- |
| <mark style="background-color: #add8e6;">CROSS JOIN</mark> | Genera un <mark style="background-color: #ffa07a;">producto cartesiano explícito</mark>. <mark style="background-color: #90ee90;">Útil para generar matrices de datos</mark>. |
| <mark style="background-color: #add8e6;">NATURAL JOIN</mark> | <mark style="background-color: #ffff00;">Une tablas automáticamente</mark> por columnas homónimas. <mark style="background-color: #ffa07a;">Advertencia: Funciona incluso sin PK/FK definidas</mark> siempre que los nombres coincidan. |
| <mark style="background-color: #add8e6;">JOIN USING</mark> | Permite <mark style="background-color: #90ee90;">especificar manualmente la columna común</mark>, <mark style="background-color: #ffa07a;">evitando uniones accidentales</mark> en tablas con múltiples campos iguales. |
| <mark style="background-color: #add8e6;">JOIN ON</mark> | El estándar para <mark style="background-color: #add8e6;">asociaciones complejas</mark> o cuando los nombres de columna difieren entre tablas. |
| <mark style="background-color: #add8e6;">LEFT OUTER JOIN</mark> | Composición externa que <mark style="background-color: #90ee90;">preserva todos los registros de la tabla izquierda</mark>. |
| <mark style="background-color: #add8e6;">FULL OUTER JOIN</mark> | <mark style="background-color: #90ee90;">Operación exhaustiva</mark> que devuelve todas las filas de ambas tablas, asociadas o no. |

### Transición a Código Profesional (SQL99):

```sql
-- Historial laboral con JOIN ON
SELECT E.NOMBRE, E.APELLIDO1, H.FECHA_INICIO, H.FECHA_FIN
FROM EMPLEADOS E 
JOIN HISTORIAL_LABORAL H ON (H.EMPLEADO_DNI = E.DNI);

-- Departamentos y Jefes con LEFT OUTER JOIN (Sustituye al operador +)
SELECT D.NOMBRE_DPTO, D.JEFE, E.NOMBRE
FROM DEPARTAMENTOS D 
LEFT OUTER JOIN EMPLEADOS E ON (D.JEFE = E.DNI);
```

---

## 5. Operaciones de Conjuntos: Unión, Intersección y Diferencia

El <mark style="background-color: #ffff00;">álgebra de conjuntos</mark> permite consolidar o contrastar verticalmente información de fuentes diversas, tratando los resultados del SELECT como <mark style="background-color: #add8e6;">conjuntos matemáticos</mark>.

### Operadores Principales

*   <mark style="background-color: #add8e6;">UNION</mark>: <mark style="background-color: #90ee90;">Consolida filas</mark> de ambos conjuntos <mark style="background-color: #90ee90;">eliminando duplicados</mark>.
*   <mark style="background-color: #add8e6;">INTERSECT</mark>: Identifica <mark style="background-color: #90ee90;">registros comunes</mark> presentes en todas las fuentes consultadas.
*   <mark style="background-color: #add8e6;">MINUS</mark>: Extrae la <mark style="background-color: #ffff00;">diferencia</mark> (registros presentes en el conjunto A pero no en el B).

### Requisitos de Arquitectura

Para que estas operaciones sean válidas, es <mark style="background-color: #ffa07a;">imperativo</mark> que las consultas compartan:
1. El <mark style="background-color: #ffff00;">mismo número de columnas</mark>.
2. <mark style="background-color: #ffff00;">Tipos de datos compatibles</mark>.
3. El <mark style="background-color: #ffff00;">mismo orden de proyección</mark>.

### Ejemplos de Aplicación:

*   <mark style="background-color: #add8e6;">INTERSECT</mark>: Localizar alumnos inscritos simultáneamente en <mark style="background-color: #add8e6;">INGLES, FRANCES y PORTUGUES</mark>.
*   <mark style="background-color: #add8e6;">MINUS</mark>: Generar una lista de alumnos de <mark style="background-color: #add8e6;">INGLES que no han iniciado el curso de PORTUGUES</mark> para campañas de fidelización.

---

## 6. Subconsultas y Lógica de Comparación Avanzada

Las <mark style="background-color: #ffff00;">subconsultas</mark> actúan como <mark style="background-color: #90ee90;">filtros dinámicos</mark>, permitiendo que el resultado de una operación interna sirva de parámetro para la consulta principal, facilitando comparaciones contra <mark style="background-color: #ffff00;">datos no conocidos a priori</mark>.

### Estrategia de Comparación

1.  <mark style="background-color: #add8e6;">Valor Único</mark>: Operadores <mark style="background-color: #add8e6;">=, >, <</mark>. <mark style="background-color: #ffa07a;">Error garantizado si la subconsulta devuelve múltiples filas</mark>.
2.  <mark style="background-color: #add8e6;">Múltiples Filas</mark>: Requieren instrucciones de conjunto:
    *   <mark style="background-color: #add8e6;">IN</mark>: Pertenencia al conjunto.
    *   <mark style="background-color: #add8e6;">ANY</mark>: La condición es verdadera si se cumple para al menos un elemento.
    *   <mark style="background-color: #add8e6;">ALL</mark>: <mark style="background-color: #90ee90;">Validación contra la totalidad</mark> del conjunto.

### Análisis de Eficiencia con ALL

Para encontrar al empleado con el <mark style="background-color: #add8e6;">salario mínimo</mark> sin recurrir a funciones de agregado, utilizamos:

```sql
SELECT NOMBRE, SALARIO
FROM EMPLEADOS
WHERE SALARIO <= ALL (SELECT SALARIO FROM EMPLEADOS);
```

El uso de <mark style="background-color: #d3d3d3;">ALL</mark> es una <mark style="background-color: #90ee90;">técnica robusta de comparación de conjuntos</mark> que garantiza que el valor seleccionado sea menor o igual que cualquier otro valor existente en la tabla.

---

## 7. Apéndice: Resolución de Casos Prácticos

A continuación, se detalla la lógica necesaria para resolver el <mark style="background-color: #d3d3d3;">"Ejercicio 7"</mark> utilizando el esquema técnico extraído del sistema (<mark style="background-color: #d3d3d3;">DESC EMPLEADOS y DESC DEPARTAMENTOS</mark>).

### Caso 1: Proyección de Historial Salarial

**Enunciado**: Mostrar nombres de empleados, sus salarios históricos y fechas de inicio.

*   <mark style="background-color: #ffff00;">Lógica de Negocio</mark>: Requiere una <mark style="background-color: #add8e6;">composición interna entre EMPLEADOS e HISTORIAL_LABORAL</mark>.
*   <mark style="background-color: #add8e6;">Campos Clave</mark>: E.NOMBRE, E.APELLIDO1, H.SALARIO_HIST (campo implícito en el historial), H.FECHA_INICIO.
*   <mark style="background-color: #ffff00;">Punto de Unión</mark>: <mark style="background-color: #add8e6;">EMPLEADOS.DNI = HISTORIAL_LABORAL.EMPLEADO_DNI</mark>.

### Caso 2: Auditoría por DNI '12345'

**Enunciado**: Histórico laboral del DNI '12345' con nombre de puesto y rango salarial.

*   <mark style="background-color: #ffff00;">Lógica de Negocio</mark>:
    1. <mark style="background-color: #add8e6;">Filtro restrictivo inicial</mark>: `WHERE E.DNI = '12345'`.
    2. Asociación con <mark style="background-color: #add8e6;">HISTORIAL_LABORAL</mark> para obtener los periodos.
    3. <mark style="background-color: #ffa07a;">Nota de Arquitectura</mark>: Dado que la tabla EMPLEADOS solo contiene datos personales, la obtención del "nombre del puesto" y "rango salarial" requiere un <mark style="background-color: #add8e6;">JOIN adicional con una tabla de PUESTOS o CATEGORIAS</mark>, asumiendo que el código de puesto reside en el historial del empleado.
*   <mark style="background-color: #add8e6;">Columnas Resultantes</mark>: E.NOMBRE, E.APELLIDO1, P.NOMBRE_PUESTO, P.MIN_SALARIO, P.MAX_SALARIO.

La aplicación rigurosa de estas técnicas asegura una <mark style="background-color: #90ee90;">recuperación de información precisa, escalable y alineada con los estándares de excelencia</mark> en ingeniería de datos.